---
tags:
  - 算法
  - 博弈  
---

##  2029. 石子游戏 IX

**题目地址：**[2029. 石子游戏 IX - 力扣（LeetCode） (leetcode-cn.com)](https://leetcode-cn.com/problems/stone-game-ix/)

## 题目

Alice 和 Bob 再次设计了一款新的石子游戏。现有一行 n 个石子，每个石子都有一个关联的数字表示它的价值。给你一个整数数组 `stones` ，其中 `stones[i]` 是第 `i `个石子的价值。

Alice 和 Bob 轮流进行自己的回合，**Alice** 先手。每一回合，玩家需要从 `stones` 中移除任一石子。

- 如果玩家移除石子后，导致 所有已移除石子 的价值 总和 可以被 3 整除，那么该玩家就**输掉游戏** 。
- 如果不满足上一条，且移除后没有任何剩余的石子，**那么 Bob 将会直接获胜**（即便是在 Alice 的回合）。

假设两位玩家均采用 `最佳` 决策。如果 Alice 获胜，返回 `true` ；如果 Bob 获胜，返回 `false` 。

**示例1**

```
输入：stones = [2,1]
输出：true
解释：游戏进行如下：
- 回合 1：Alice 可以移除任意一个石子。
- 回合 2：Bob 移除剩下的石子。 
已移除的石子的值总和为 1 + 2 = 3 且可以被 3 整除。因此，Bob 输，Alice 获胜。
```

**示例2**

```
输入：stones = [2]
输出：false
解释：Alice 会移除唯一一个石子，已移除石子的值总和为 2 。 
由于所有石子都已移除，且值总和无法被 3 整除，Bob 获胜。
```

## 解题思路

为了方便，我们用 `A` 来代指 `Alice`，用 `B` 带代指 `Bob`。

A 只有一种获胜方式，是使得 B 在选石子时凑成 33的倍数；而 B 除了能够通过让 A 凑成 3的倍数以外，还能通过让游戏常规结束来获胜。

因此整个游戏过程，我们只需要关心「已被移除的石子总和」和「剩余石子个数/价值情况」即可。

更进一步的，我们只需关心已被移除的石子总和是否为 3的倍数，以及剩余石子的价值与已移除石子总和相加是否凑成 3 的倍数即可。

所以我们可以按照石子价值除以 3 的余数分成三类，并统计相应数量。

不失一般性考虑，某个回合开始前，已移除的石子总和状态为 x（共三种，分别为除以 3 余数为 00、1 和 2，其中当状态为 0，且非首个回合时，说明凑成 3 的倍数，游戏结束），剩余石子价值除以 3 的余数 ss 分别为 0、1 和 2。

**首先如果当前 x = 1 时，不能选择 s = 2 的石子，否则会导致凑成总和为 3 的倍数而失败；同理 x = 2时，不能选择 s = 1 的石子；而选择 s = 0 的数字，不会改变 x 的状态，可看做换手操作。**

**同时成对的 s = 0 的等价于没有 s = 0的石子（双方只需要轮流选完这些 s = 0的石子，最终会回到先手最开始的局面）；而选择与 x相同的 s 会导致 x 改变（即 x = 1 时，选择 s = 1 的石子，会导致 x = 2；而 x = 2 时，选 s = 2 的石子，会导致 x = 1）。**

明确规则后，是分情况讨论的过程：

- **s=0的石子数量为偶数**:此时等价于没有s=0的石子，只需要关心s=1和s=2即可
  - **s=1的石子数量为0：**此时意味着只有s=2的石子，此时意味着 A 开始选择的只能是 s = 2，此时交给 B 的局面为「x = 2、剩余石子只有 s = 2」，此时 B 只能选 s = 2的石子，由于 x = 2 且选择的石子 s = 2，因此交由回 A 的局面为「x = 1，剩余是在只有 s = 2」，因此游戏继续的话 A 必败，同时如果在该过程的任何时刻石子被取完，也是 B 直接获胜，即 **A 仍为必败**；
  - **s = 2的石子数量为 0**：分析同理，A 只能选 s = 1，此时交给 B 的局面为「x = 1、剩余石子只有 s = 1」，此时 B 只能选 s = 1 的石子，由于 x = 1 且选择的石子 s = 1，因此交由回 A 的局面为「x = 2，剩余是在只有 s = 1」，因此游戏继续的话 A 必败，同时如果在该过程的任何时刻石子被取完，也是 B 直接获胜，即 **A 仍为必败**；
  - **s=2和s=1的石子数量都不为0：**A选择只要不是数量最多的那一类型的石子，B只能选择相同类型的石子（或者没有选择导致失败）然后游戏继续，最终 `B` 会先进入「只能凑成 3 的倍数」的局面导致失败，即 **`A` 必胜。**
- **s=0的石子数量为奇数：**此时相当于有一次换手的机会，此换手的机会必然会用户必败的情况系进行转移才会有意义。因此只有s=1和s=2的石子数量差大于2的时候，先手优势不会因为转手机会才会转移
  - **两者数量差不超过2**：此时B可以用「对方凑成3必输」的规则优先利用s=0的石子保证自己进入必胜状态
    - **当s=1 和 s = 2的石子数量相等**，虽然有 s = 0 的石子，A 先手，但是 A 的首个回合必然不能选 s = 0，否则马上失败结束，因此 A 只能选 s = 1 或 s = 2，此时 B直接选择 s = 0 的石子，交由给 A 的局面 xx 没有发生改变，A 只能选择与首个回合相同的 s 游戏才能继续，因此局面会变为「B 先手、s = 1 和 s = 2 的石子数量差为 2」，游戏继续，**最终 A 会先遇到「只能凑成 3 的倍数」的局面，即 B 必胜。**
    - **两者数量差不超过 2**：此时无论 A 选择数量较少或较多的 s，B 都在第二回合马上使用 s = 0的石子进行换手，A 只能继续选与第一回合相同类型的的石子，游戏才能进行，最**终 A 会先遇到「只能凑成 3 的倍数」或「石子被取完」的局面，即 B 必胜**。
  - **两者数量差超过2：**此时即使 **A 只要确保第一次选择数量较多的 s**，不管 B 是否使用「优先使用 s = 0」的石子，A 都有足够次数数量多 s 来抵消换手（或是在 B 放弃使用 s = 0 之后马上使用），最终都是 B 最先遇到「只能凑成 3 的倍数」的局面，即 A 获胜

### 代码

```java
public class Code2029 {
    public boolean stoneGameIX(int[] stones) {
        int[] nums=new int[3];
        for (int stone : stones) {
            //统计是余数是0，1，2的数组中出现的个数
            nums[stone%3]++;
        }
        return nums[0] % 2 == 0 ? !(nums[1] == 0 || nums[2] == 0) : !(Math.abs(nums[1] - nums[2]) <= 2);

    }
}
```

